var version="0.18";var alamode={reportError:function(a){$("<h1 class='mode-error'>").text(a).prependTo(document.body)},getColumnsFromQuery:function(b){var a=datasets.filter(function(c){if(c){return c.queryName==b}})[0];if(!a){alamode.reportError("No such query: '"+b+"'");return[]}return a.columns},getDataFromQuery:function(b){var a=datasets.filter(function(c){if(c){return c.queryName==b}})[0];if(!a){alamode.reportError("No such query: '"+b+"'");return[]}return a.content},makeId:function(c){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",d="";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d},addContainerElement:function(b,a){a=a||false;id=alamode.makeId(10);if(b=="body"){$("<div id='"+id+"'></div>").addClass(id).addClass("mode-graphic-container").appendTo(".mode-content")}else{if($(b).length===0){alamode.reportError("No such element: '"+b+"'")}else{if(a){$(b).empty()}$(b).addClass("mode-graphic-container");$(b).addClass(id)}}return"."+id},addLinksToTables:function(b){var e="#"+b.table_id,c=b.link_columns,d=b.link_urls,h=b.query_name;var j=("new_tab" in b)?b.new_tab:[];var a=[];var l={};c.forEach(function(m,n){a.push({column:m,link_string:d[n],new_tab:(j.length>n)?j[n]:false})});var g=alamode.getDataFromQuery(h),f=alamode.getColumnsFromQuery(h);setTimeout(function(){k(a)},1000);$(e).mousemove(function(){k(a)});function k(r){var n=$(e+" table"),m=$(e+" .js-header-table"),q=!m?$(m).find("th"):$(e+" .js-col-header"),p=n.find("tr"),o=0;q.each(function(){text=$(this).find(".axel-table-header-label").text();o=$(this).attr("data-axel-column");l[text]=o-1});p.each(function(t){if(t>0&&t<=g.length){var s=$(this).find("td"),u=s.first().attr("data-axel-rowkey");r.forEach(function(z){var F=l[z.column],v=s.eq(F).text();url=z.link_string;while(url.indexOf("{{")!=-1){var D=url.length,w=url.indexOf("{{"),A=url.substring(w+2,D).indexOf("}}"),E=url.substring(w+2,w+A+2),B=url.substring(w,w+A+4),x=l[E],C=g[u][E];url=url.replace(B,C)}target=z.new_tab?" target='_blank'":"";s.eq(F).html("<a href='"+encodeURI(url)+"'"+target+">"+v+"</a>")})}})}},customChartColors:function(g){var f=g.charts,b=g.colors,e=g.opacity,a=g.line_dashes;if(f=="all"){f=[];$("mode-chart").each(function(){f.push(this.id)})}function c(n,s){var t=$("#"+n),q=t.find(".nv-bar").length>0?t.find(".nv-group"):t.find(".nv-line").length>0||t.find(".nv-areaWrap").length>0?t.find(".nv-noninteractive"):t.find(".nv-pie .nv-slice"),p=q.length,u=t.find(".nv-series .nv-legend-symbol");var l={};var o={};var k={};var j=0;if(u.length==0&&p<=1){o[0]=j;k[j]=0;l[0]=s[0]}else{if(u.length==0&&p>1){for(i=0;i<p;i++){o[i]=i;l=s}}else{for(i=0;i<u.length;i++){l[i]=s[i%Object.keys(s).length]}}}u.each(function(m){if($(this).css("fill-opacity")==1){o[m]=j;k[j]=m;j+=1}else{o[m]=-1}});return{chart:t,legend:u,colors:l,m:o,r:k,seriesCount:p}}function d(q,n){var p=c(q,n),o=p.chart,k=p.colors,j=p.m;for(var l in k){o.find(".nv-linesWrap .nv-groups .nv-series-"+j[l]).css({fill:k[l],stroke:k[l]});o.find(".nv-barsWrap .nv-groups .nv-series-"+j[l]+" rect").css({fill:k[l],stroke:k[l]});o.find(".nv-linePlusBar .nv-barsWrap .nv-bars rect").each(function(m){$(this).css({fill:k[0],stroke:k[0]})});o.find(".nv-linePlusBar .nv-linesWrap .nv-groups .nv-series-0").css({fill:k[1],stroke:k[1]});o.find(".nv-scatterWrap .nv-groups .nv-series-"+j[l]).css({fill:k[l],stroke:k[l]});o.find(".nv-areaWrap .nv-area-"+j[l]).css({fill:k[l],stroke:k[l]});o.find(".nv-pie .nv-slice").each(function(m){$(this).css({fill:k[m],stroke:k[m]})})}for(var l in e){o.find(".nv-linesWrap .nv-groups .nv-series-"+j[l]).css({opacity:e[l]});o.find(".nv-barsWrap .nv-groups .nv-series-"+j[l]+" rect").css({opacity:e[l]});if(l==0){o.find(".nv-linePlusBar .nv-barsWrap .nv-bars rect").each(function(m){$(this).css({opacity:e[l]})});o.find(".nv-linePlusBar .nv-linesWrap .nv-groups .nv-series-0").css({opacity:e[1]})}o.find(".nv-scatterWrap .nv-groups .nv-series-"+j[l]).css({opacity:e[l]});o.find(".nv-areaWrap .nv-area-"+j[l]).css({opacity:e[l]});o.find(".nv-pie .nv-slice").each(function(m){$(this).css({opacity:e[m]})})}for(var l in a){o.find(".nv-linesWrap .nv-groups .nv-series-"+j[l]).css({"stroke-dasharray":a[l]})}o.find(".nv-legendWrap .nv-series .nv-legend-symbol").each(function(m){$(this).css({fill:k[m],stroke:k[m]})})}function h(l,j){var k=$("#"+l);$(k).mousemove(function(){var t=c(l,j),w=t.legend,p=t.colors,o=t.r,q=t.m,s=t.seriesCount,u=isArea=k.find(".nv-area").length,x=k.find(".nv-bar").length,v=k.find(".nv-line").length;$("html").find(".nvtooltip table .legend-color-guide").each(function(r){if(w.length==0&&x==0){$(this).find("div").css({"background-color":p[q[r]]})}else{if(v>0&&x>0){var z=k.find(".nv-linePlusBar .nv-linesWrap .nv-groups .nv-series-0").css("fill"),m=k.find(".nv-linePlusBar .nv-barsWrap .nv-bars rect").css("fill");if($(this).closest(".nvtooltip").find(".key")[0].innerText==""){$(this).find("div").css("background-color",m)}else{$(this).find("div").css("background-color",z)}}else{if(x>0){if(s==1){$(this).find("div").css({"background-color":p[o[s-r-1]]})}}else{if(u>0){$(this).find("div").css({"background-color":p[u-r-1]})}else{$(this).find("div").css({"background-color":p[r]})}}}}});var n=k.find(".nv-pie .nv-slice.hover").css("fill");$("html").find(".nvtooltip table .legend-color-guide div").css("background-color",n)});$(k).mouseleave(function(){$("html").find(".nvtooltip table .legend-color-guide").remove()})}setInterval(function(){f.forEach(function(j){d(j,b)})},500);f.forEach(function(j){h(j,b)})},addTotalsRow:function(d){var k=d.query_name,l=d.table_id||"",f="#"+l,m=alamode.getColumnsFromQuery(k),h=alamode.getDataFromQuery(k),j=d.columns_with_totals;var e=d3.format(",");var a=n(j),c=b(a);function n(o){numberColumns=_.map(_.filter(m,function(p){return["number","integer","float"].indexOf(p.type)!=-1}),"name");if(o=="all"){return numberColumns}else{return _.intersection(o,numberColumns)}}function b(p){var o=[];m.forEach(function(u,r){if(p.indexOf(u.name)==-1){var t={idx:r,name:"",total:""}}else{var q=_.map(h,u.name),s=d3.sum(q);var t={idx:r,name:u.name,total:s}}o.push(t)});return o}function g(o){var p="<tr><td>TTL</td>";o.forEach(function(q){if(q.total!=""){p=p+"<td class='cell-type-number'>"+e(q.total)+"</td>"}else{p=p+"<td></td>"}});return p+"</tr>"}setTimeout(function(){if(f=="#"){table=$(".main-table");container=$(".js-table-content-container")}else{table=$(f+" .main-table");container=$(f+" .js-table-content-container")}var q=table.find("tr:last");var o=g(c);var p=container.css("height");var r=+p.match(/\d+/)[0];q.after(o);container.css("height",r+26)},1000)},addImagesToTables:function(e){var d="#"+e.table,c=e.column,a=e.image_height||100;setTimeout(function(){b()},1000);$(d).keyup(function(){setTimeout(function(){b()},500)});$(d).mousemove(function(){b()});function b(){var g=$(d+" table"),f=$(d+" .js-header-table"),k=!f?$(f).find("th"):$(d+" .js-col-header"),j=g.find("tr"),h=0;k.each(function(){text=$(this).find(".axel-table-header-label").text();if(text==c){h=+$(this).attr("data-axel-column")}});j.each(function(){var l=$(this).find("td");l.each(function(m){if(m==(h-1)){var n=$(this).text();if($(this).find("img").length==0){$(this).css("text-align","center");$(this).html("<img style='height: "+a+"px;' src='"+n+"'>")}}})})}},resizeChartHeight:function(c){var b=c.chart,a=c.height;if(b.slice(0,6)=="python"){$("#"+b+" .mode-python").css("height",a);$("#"+b+" .mode-python").css("max-height",a);$("#"+b+" img").css("max-height",a)}else{$("#"+b+" .chart").css("height",a);$("#"+b+" .chart-svg").css("height",a)}window.dispatchEvent(new Event("resize"))},retentionHeatmap:function(p){var e=p.query_name,g=p.cohort_column,f=p.pivot_column,r=p.value_column,h=p.color_gradient||["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],k=p.total_column,A=p.html_element||"body",z=p.title||e,w=p.pivot_label||"",b=p.value_is_percent,t=p.precision||0;var x=alamode.getDataFromQuery(e),d=alamode.getColumnsFromQuery(e),l=_.uniq(_.map(x,g)),m=_.uniq(_.map(x,f));var a=alamode.addContainerElement(A);var s=d3.scale.quantize().domain(d3.extent(x,function(o){return o[r]})).range(h);d3.select(a).append("div").attr("class","mode-graphic-title").text(z);d3.select(a).append("div").attr("class","mode-retention-heatmap-label").text(w);if(k){headers=[g,k].concat(m)}else{headers=[g].concat(m)}var u=d3.select(a).append("table").attr("class","mode-retention-heatmap-table");u.selectAll(".mode-retention-heatmap-table-header").data([0]).enter().append("tr").attr("class","mode-retention-heatmap-table-header").selectAll("mode-retention-heatmap-table-header-cell").data(headers).enter().append("td").attr("class",function(o){if(isNaN(o)){return"mode-retention-heatmap-table-header-cell heatmap-string"}else{return"mode-retention-heatmap-table-header-cell heatmap-number"}}).text(function(o){return o});u.selectAll(".mode-retention-heatmap-table-row").data(l).enter().append("tr").attr("class","mode-retention-heatmap-table-row").selectAll(".mode-retention-heatmap-table-cell").data(function(o){return v(x,o)}).enter().append("td").style("background",function(o){if(j(o)){return s(o.value)}}).attr("class",function(o){return n(o)}).text(function(o){return c(o,p)});function j(o){if(o.value==""){return false}else{if(o.column==f||o.column==k){return false}else{if(o.column==r){return true}else{return false}}}}function n(B){var o=q(B.column);if(o=="float"||o=="integer"||o=="number"){return"heatmap-number"}else{return"heatmap-string"}}function q(o){return d.filter(function(B){return B.name==o})[0].type}function v(D,o){var E=[{column:g,value:o}];if(k){var B=_.filter(D,function(F){return F[g]==o})[0],C={column:k,value:B[k]};E=E.concat(C)}m.forEach(function(G){var F=_.filter(D,function(H){return H[g]==o&&H[f]==G});if(F.length>0){entry=d3.mean(_.map(F,r))}else{entry=""}E=E.concat({column:r,value:entry})});return E}function c(C){var B=q(C.column);var E=d3.format(","),D=d3.format("."+t+"%"),o=d3.time.format("%b %d, %Y");if(C.value==""){return C.value}else{if(B=="datetime"||B=="timestamp"||B=="date"){if(typeof moment=="function"){return moment(C.value).utc().format("ll")}else{return o(new Date(C.value))}}else{if(C.column==k){return E(C.value)}else{if(C.column==r&&b){return D(C.value)}else{if(C.column==r){return E(C.value)}else{return C.value}}}}}}},googleMap:function(d){var b=alamode.makeId(10);var m=d.lat_column,e=d.lng_column,n=d.query_name,k=d.google_maps_api_key,p=d.title||n,q=d.label_column,g=d.html_element||"body",a=d.center_lat||39.5,c=d.center_lng||-98.35,r=d.starting_zoom||4,f=d.map_type||"terrain",l=d.height||600;var j=alamode.getDataFromQuery(n);var h=alamode.addContainerElement(g);d3.select(h).append("div").attr("class","mode-graphic-title").text(p);d3.select(h).append("div").attr("class","mode-google-map").attr("id",b).style("height",l+"px");jQuery.getScript("https://maps.googleapis.com/maps/api/js?key="+k,function(){o();function o(){var s={zoom:r,center:new google.maps.LatLng(a,c),mapTypeId:f};var t=new google.maps.Map(document.getElementById(b),s);j.forEach(function(z){var x=z[m],v=z[e];if(q){label=z[q]}else{label=""}var u=new google.maps.Marker({position:{lat:x,lng:v},map:t,title:label});var w=new google.maps.InfoWindow({content:label});u.addListener("click",function(){w.open(t,u)})})}})},leafletMap:function(q){var p=alamode.makeId(10);var B=q.lat_column,j=q.lng_column,e=q.query_name,A=q.title||e,n=q.height||400,D=q.html_element||"body",c=q.center_lat||39.5,t=q.center_lng||-98.35,a=q.starting_zoom||4,g=q.dot_size||0.4,z=q.dot_opacity||0.8,w=q.apply_filter||false;var x=alamode.getDataFromQuery(e),l=[];x.forEach(function(o){if(typeof o[B]==="number"&&typeof o[j]==="number"){l.push(o)}});var b=alamode.addContainerElement(D,w);d3.select(b).style("height",n+"px").append("div").attr("class","mode-graphic-title").text(A);var r=n-$(b+".mode-graphic-title").height(),s=$(b).width();d3.select(b).append("div").attr("class","mode-leaflet-map").attr("id",p).style("height",r+"px").style("width",s+"px");var f=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18});var u={max:8,data:l};var h={radius:g,maxOpacity:z,scaleRadius:true,useLocalExtrema:true,latField:B,lngField:j};var m={lat:c,lng:t,zoom:a};var k=new HeatmapOverlay(h);var v=new L.Map(p,{center:new L.LatLng(m.lat,m.lng),zoom:Math.floor(m.zoom),layers:[f,k]});k.setData(u)},wordCloud:function(c){var j=c.query_name,k=c.word_column,g=c.word_count_column,d=c.html_element||"body",m=c.title||j,p=c.height||"400",b=c.width||"800",a=c.colors||["black"];var f=alamode.getDataFromQuery(j);var e=alamode.addContainerElement(d);d3.select(e).append("div").attr("class","mode-graphic-title").text(m);var n=d3.scale.linear().domain(d3.extent(f,function(o){return o[g]})).range([12,60]);var h=d3.layout.cloud().size([b,p]).words(f.map(function(o){return{text:o[k],size:n(o[g])}})).padding(2).rotate(function(){return(~~(Math.random()*6)-3)*360}).font("Impact").fontSize(function(o){return o.size}).on("end",l);h.start();function l(o){d3.select(e).append("div").attr("class","mode-wordcloud").append("svg").attr("width",h.size()[0]).attr("height",h.size()[1]).append("g").attr("transform","translate("+h.size()[0]/2+","+h.size()[1]/2+")").selectAll("text").data(o).enter().append("text").style("font-size",function(q){return q.size+"px"}).style("font-family","Impact").style("fill",function(r,q){return a[q%a.length]}).attr("text-anchor","middle").attr("transform",function(q){return"translate("+[q.x,q.y]+")rotate("+q.rotate+")"}).text(function(q){return q.text})}},funnel:function(c){var b=alamode.makeId(10);var j=c.query_name,d=c.stage_column,p=c.value_column,e=c.html_element||"body",k=c.title||j,m=c.height||"300",a=c.width||"500";var g=alamode.getDataFromQuery(j);var f=alamode.addContainerElement(e);d3.select(f).append("div").attr("class","mode-graphic-title").text(k);d3.select(f).append("div").attr("class","mode-funnel").attr("id",b).style("width",a+"px").style("height",(m-20)+"px");var l=[];g.forEach(function(o){l.push([o[d],o[p]])});var n={label:{format:"{l}: {f}"},block:{dynamicHeight:true},chart:{bottomPinch:1},animation:100};var h=new D3Funnel("#"+b);h.draw(l,n);d3.select("#"+b).style("height",m+"px")},horizontalBarChart:function(g){var f=g.query_name,c=g.bar_column,d=g.series_columns,a=g.colors||["#EE8D24","#43A5DA","#6AB328","#BB60F8","#E14459","#EAD022","#06D0AD","#DB38B7"];stacked=g.stacked||false,leftpad=g.left_pad||175,htmlElement=g.html_element||"body",title=g.title||f,height=g.chart_height||395,width=g.width||"500";var e=alamode.getDataFromQuery(f);var b=alamode.addContainerElement(htmlElement);d3.select(b).append("div").attr("class","mode-graphic-title").text(title);d3.select(b).append("div").attr("class","mode-horizontal-bar-chart").style("height",(height-50)+"px").append("svg");var h=[];d.forEach(function(m,l){var k={key:m,color:a[l%a.length]};var j=[];e.forEach(function(n){j.push({label:n[g.bar_column],value:n[m]})});k.values=j;h.push(k)});nv.addGraph(function(){var j=nv.models.multiBarHorizontalChart().x(function(k){return k.label}).y(function(k){return k.value}).margin({top:30,right:20,bottom:50,left:leftpad}).showValues(true).showControls(false).stacked(stacked);j.yAxis.tickFormat(d3.format(",.2f"));d3.select(b+" svg").datum(h).call(j);nv.utils.windowResize(j.update);return j})},chartAnnotations:function(a){var k="#"+a.chart_id,b=a.x_axis_column,h=a.query_name,j=a.orientations,m=a.comment_values,n=a.group_by,g=a.comments;var f=alamode.getDataFromQuery(h);var e=[];var c={};if(n){c=_.groupBy(f,function(o){return o[n]})}g.forEach(function(q,p){var o=_.filter(f,function(r){return r[b]==m[p]});if(o.length!=0){if(n){pointNumber=c[o[0][n]].indexOf(o[0])}else{pointNumber=f.indexOf(o[0])}}else{pointNumber=-1}e.push(pointNumber)});function d(){g.forEach(function(M,E){var G=e[E],o=j[E],B=m[E];var v=d3.tip().attr("class","d3-tip").style("z-index",100).offset([-10,0]).html(function(P){return P});var u=$(k).find("g.nvd3.nv-wrap").attr("transform"),J=u.indexOf("("),C=u.indexOf(")"),t=u.indexOf(",");var p=+u.slice(J+1,t),r=+u.slice(t+1,C);if(G!=-1&&o=="v"){var F=$(k).find(".nv-point.nv-point-"+G).attr("transform"),q=F.indexOf("("),z=F.indexOf(")"),s=F.indexOf(",");var D=+F.slice(q+1,s),I=+F.slice(s+1,z);var x=$(k).find("g.nvd3.nv-wrap").first().find("rect").first().attr("height"),A=$(k).find("g.nvd3.nv-wrap").first().find("rect").first().attr("width");var w=d3.select(k+" .nvd3svg");w.call(v);w.append("rect").attr("x",D+p).attr("y",r-5).attr("width",1).attr("class","flag").attr("height",I+5).attr("fill","#ff8f53");w.append("circle").data([M]).attr("cx",D+p).attr("cy",r-5).attr("class","flag").attr("r",5).attr("fill","#ff8f53").on("mouseover",v.show).on("mouseout",v.hide)}else{if(o=="h"||o=="h-left"||o=="h-right"){if(o=="h"){y=""}else{if("h-left"){y="1"}else{y="2"}}var N=$(k).find("g.nv-y"+y+".nv-axis").find(".tick");N.each(function(P){if(o=="h-right"){lineLength=+$(k).find("g.nv-y1.nv-axis").find(".tick").first().find("line").attr("x2")}else{lineLength=+$(this).find("line").attr("x2")}tickTrans=$(this).attr("transform");tickClosePos=tickTrans.indexOf(")"),tickCommaPos=tickTrans.indexOf(",");if(P==0){yTrans1=+tickTrans.slice(tickCommaPos+1,tickClosePos);yVal1=+$(this).find("text").text().replace(",","")}else{if(P==1){yTrans2=+tickTrans.slice(tickCommaPos+1,tickClosePos);yVal2=+$(this).find("text").text().replace(",","")}}});var O=(yTrans2-yTrans1)/(yVal2-yVal1),K=yTrans2-(yVal2*O);var H=K+(B*O);var w=d3.select(k+" .nvd3svg");w.call(v);w.append("rect").attr("x",p).attr("y",H+r).attr("width",lineLength+10).attr("height",1).attr("class","flag").attr("fill","#ff8f53");w.append("circle").data([M]).attr("cx",lineLength+p+10).attr("cy",H+r).attr("class","flag").attr("r",5).attr("fill","#ff8f53").on("mouseover",v.show).on("mouseout",v.hide)}}})}setTimeout(function(){d3.select(k).selectAll(".flag").remove();d()},1000);$(window).resize(function(){d3.select(k).selectAll(".flag").remove();l(function(){d()},500,"")});var l=(function(){var o={};return function(r,p,q){if(!q){q="Don't call this twice without a uniqueId"}if(o[q]){clearTimeout(o[q])}o[q]=setTimeout(r,p)}})()},bulletChart:function(c){var a=alamode.makeId(10);var h=c.query_name,d=c.html_element||"body",k=c.title||h,b=c.chart_width||"800",j=c.bar_column||"",m=c.marker_column||"",l=c.left_pad||150,f=c.color;var g=alamode.getDataFromQuery(h);var e=alamode.addContainerElement(d);d3.select(e).append("div").attr("class","mode-graphic-title").text(k);d3.select(e).append("div").attr("class","mode-bullet-chart").style("width",b).attr("id",a);g.forEach(function(s){var r=s[c.title_column]||"",o=s[c.subtitle_column]||"",n=s[c.marker_column]||"",p=s[c.bar_column]||"";if(c.scale_columns){scale=[s[c.scale_columns[0]],s[c.scale_columns[1]],s[c.scale_columns[2]]]}else{scale=c.scale_columns}var q={title:r,subtitle:o,ranges:scale,measures:[p],measureLabels:[j],markers:[n],markerLabels:[m],color:f};nv.addGraph(function(){var u=nv.models.bulletChart().height(50).width(b).margin({left:l,right:15,top:10,bottom:10});var t=d3.select("#"+a).append("svg").style("width",b+"px").style("height",70+"px").style("display","inline").datum(q).transition().duration(500).call(u);return u})})},sunburstChart:function(v){var u=alamode.makeId(10);var e=v.query_name,z=v.event_columns,x=v.event_counts,I=v.title||e,n=v.color_range||["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],J=v.html_element||"body";var G=alamode.getDataFromQuery(e);var s=600,w=850,g=Math.min(w,s)/2,F=(w-30)/z.length,D={w:F,h:20,s:3,t:10};var A=[];z.forEach(function(b){A=A.concat(_.uniq(_.map(G,b)))});var d=_.uniq(A);var m={};d.forEach(function(o,b){if(o!=null){m[o]=n[b%(n.length)]}});m.end="#666";var q=0;var c=alamode.addContainerElement(J);d3.select(c).append("div").attr("class","mode-graphic-title").text(I);d3.select(c).append("div").attr("class","mode-sunburst-sequence").attr("id","sequence-"+u);d3.select(c).append("div").attr("class","mode-sunburst").attr("id",u);d3.select(c).append("div").attr("class","mode-sunburst-legend-container").attr("id","legend-container-"+u);vis=d3.select("#"+u).append("svg:svg").attr("width",w).attr("height",s).append("svg:g").attr("transform","translate("+w/2+","+s/2+")");vis.append("text").attr("x",0).attr("y",-30).attr("text-anchor","middle").attr("class","mode-sunburst-explanation mode-sunburst-percentage").attr("id","percentage-"+u).style("visibility","hidden").text("");vis.append("text").attr("x",0).attr("y",-10).attr("text-anchor","middle").attr("class","mode-sunburst-explanation").style("visibility","hidden").text("of total sequences.");vis.append("text").attr("x",0).attr("y",20).attr("text-anchor","middle").attr("class","mode-sunburst-explanation mode-sunburst-cond-percentage").attr("id","cond-percentage-"+u).style("visibility","hidden").text("");vis.append("text").attr("x",0).attr("y",40).attr("text-anchor","middle").attr("class","mode-sunburst-explanation").style("visibility","hidden").text("from previous location.");var h=d3.layout.partition().size([2*Math.PI,g*g]).value(function(b){return b.size});var l=d3.svg.arc().startAngle(function(b){return b.x}).endAngle(function(b){return b.x+b.dx}).innerRadius(function(b){return Math.sqrt(b.y)}).outerRadius(function(b){return Math.sqrt(b.y+b.dy)});var C=[];G.forEach(function(o){var K="";for(i=0;i<z.length;i++){if(i!=0){prefix="-~-"}else{prefix=""}if(o[z[i]]==null){K=K+prefix+"end";break}else{K=K+prefix+o[z[i]]}}var b={0:K,1:o[x]};C.push(b)});var B=t(C);r(B);function r(o){E();a();vis.append("svg:circle").attr("r",g).style("opacity",0);var b=h.nodes(o).filter(function(M){return(M.dx>0.005)});var K=vis.data([o]).selectAll("path").data(b).enter().append("svg:path").attr("display",function(M){return M.depth?null:"none"}).attr("d",l).attr("fill-rule","evenodd").style("fill",function(M){return m[M.name]}).style("opacity",1).on("mouseover",H);vis.on("mouseleave",f);q=K.node().__data__.value}function H(N){var b=(100*N.value/q).toPrecision(3);var P=b+"%";if(b<0.1){P="< 0.1%"}var M=j(N);var O=N.parent.value;var K=(100*N.value/O).toPrecision(3);var o=K+"%";if(K<1){P="< 1%"}d3.select("#cond-percentage-"+u).text(o);d3.select("#percentage-"+u).text(P);d3.selectAll(".mode-sunburst-explanation").style("visibility","");var M=j(N);k(M,P);d3.selectAll("path").style("opacity",0.3);vis.selectAll("path").filter(function(Q){return(M.indexOf(Q)>=0)}).style("opacity",1)}function f(b){d3.select("#trail-"+u).style("visibility","hidden");d3.selectAll("path").on("mouseover",null);if(d3.version.split(".")[0]==4){d3.selectAll("path").transition().duration(300).style("opacity",1).on("end",function(){d3.select(this).on("mouseover",H)})}else{d3.selectAll("path").transition().duration(300).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",H)})}d3.selectAll(".mode-sunburst-explanation").style("visibility","hidden")}function j(b){var K=[];var o=b;while(o.parent){K.unshift(o);o=o.parent}return K}function E(){var b=d3.select("#sequence-"+u).append("svg:svg").attr("width",w).attr("height",60).attr("id","trail-"+u);b.append("svg:text").attr("id","endlabel").style("fill","#000")}function p(K,b){var o=[];o.push("0,0");o.push(D.w+",0");o.push(D.w+D.t+","+(D.h/2));o.push(D.w+","+D.h);o.push("0,"+D.h);if(b>0){o.push(D.t+","+(D.h/2))}return o.join(" ")}function k(o,M){var b=d3.select("#trail-"+u).selectAll("g").data(o,function(N){return N.name+N.depth});var K=b.enter().append("svg:g");K.append("svg:polygon").attr("points",p).style("fill",function(N){return m[N.name]});K.append("svg:text").attr("x",(D.w+D.t)/2).attr("y",D.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(N){return N.name});b.attr("transform",function(O,N){if(N>5&&N<10){N=N-5;return"translate("+N*(D.w+D.s)+", 20)"}else{if(N>10){N=N-11;return"translate("+N*(D.w+D.s)+", 40)"}else{return"translate("+N*(D.w+D.s)+", 0)"}}});b.exit().remove();d3.select("#trail-"+u).style("visibility","")}function a(){var b={w:195,h:30,s:3,r:3};d3.entries(m).forEach(function(o){divContainer=d3.select("#legend-container-"+u).append("div").attr("class","mode-sunburst-legend").attr("id","legend-"+u);svg=divContainer.append("svg:svg").attr("width",b.w).attr("height",b.h);svg.append("svg:rect").attr("rx",b.r).attr("ry",b.r).attr("width",b.w).attr("height",b.h).style("fill",function(){return o.value});svg.append("svg:text").attr("x",b.w/2).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(){return o.key})})}function t(R){var T={name:"root",children:[]};for(var S=0;S<R.length;S++){var O=R[S][0];var V=+R[S][1];if(isNaN(V)){continue}var P=O.split("-~-");var o=T;for(var Q=0;Q<P.length;Q++){var K=o.children;var U=P[Q];var b;if(Q+1<P.length){var N=false;for(var M=0;M<K.length;M++){if(K[M]["name"]==U){b=K[M];N=true;break}}if(!N){b={name:U,children:[]};K.push(b)}o=b}else{b={name:U,size:V};K.push(b)}}}return T}},zipcodeChoropleth:function(l){var k=alamode.makeId(10);var b=l.query_name,g=l.zipcode_column,n=l.value_column,m=l.width||950,h=l.height||m/1.9,s=l.title||b,e=l.color_range,d=l.color_gradient||["#FFF8CC","#FFF5B2","#FFF299","#E5D87F","#CCBF66","#B2A54C","#998C33","#7F7219","#665900"],t=l.html_element||"body";var r=alamode.getDataFromQuery(b);var c=d3.map();var q=d3.geoAlbersUsa().scale(m).translate([m/2,h/2]);var j=d3.geoPath().projection(q);var a=alamode.addContainerElement(t);d3.select(a).append("div").attr("class","mode-graphic-title").text(s);svg=d3.select(a).append("div").attr("class","mode-zipcode-chorolpleth").append("svg").attr("id","mode-zipcode-chorolpleth-"+k).attr("width",m).attr("height",h);r.forEach(function(o){c.set(o[g],+o[n])});if(!e){colorDomain=d3.extent(r,function(o){return o[n]})}else{colorDomain=e}var p=d3.scale.quantize().domain(colorDomain).range(d);queue().defer(d3.json,"https://s3-us-west-2.amazonaws.com/mode-alamode/zips_us_topo.json").await(f);function f(o,u){d3.select("#mode-zipcode-chorolpleth-"+k).append("g").attr("class","zipcodes").selectAll(".mode-zipcode-chorolpleth-zipcodes"+k).data(topojson.feature(u,u.objects.zip_codes_for_the_usa).features).enter().append("path").attr("class","mode-zipcode-chorolpleth-zipcodes-"+k).attr("fill",function(v){return p(c.get(v.properties.zip))}).attr("d",j)}},countyChoropleth:function(k){var j=alamode.makeId(10);var b=k.query_name,n=k.county_id_column,m=k.value_column,l=k.width||950,g=k.height||l/1.9,s=k.title||b,e=k.color_range,d=k.color_gradient||["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],t=k.html_element||"body";var r=alamode.getDataFromQuery(b);var c=d3.map();var q=d3.geoAlbersUsa().scale(l).translate([l/2,g/2]);var h=d3.geoPath().projection(q);var a=alamode.addContainerElement(t);d3.select(a).append("div").attr("class","mode-graphic-title").text(s);svg=d3.select(a).append("div").attr("class","mode-county-chorolpleth").append("svg").attr("id","mode-county-chorolpleth-"+j).attr("width",l).attr("height",g);r.forEach(function(o){c.set(o[n],+o[m])});if(!e){colorDomain=d3.extent(r,function(o){return o[m]})}else{colorDomain=e}var p=d3.scale.quantize().domain(colorDomain).range(d);queue().defer(d3.json,"https://s3-us-west-2.amazonaws.com/mode-alamode/counties.json").await(f);function f(o,u){d3.select("#mode-county-chorolpleth-"+j).append("g").attr("class","mode-county-chorolpleth-counties").selectAll(".mode-county-chorolpleth-counties"+j).data(topojson.feature(u,u.objects.counties).features).enter().append("path").attr("class","mode-county-chorolpleth-counties-"+j).attr("fill",function(v){return p(c.get(v.id))}).attr("d",h);d3.select("#mode-county-chorolpleth-"+j).append("path").datum(topojson.mesh(u,u.objects.states,function(w,v){return w!==v})).attr("class","mode-county-chorolpleth-states").attr("d",h)}},stateChoropleth:function(m){var l=alamode.makeId(10);var d=m.query_name,c=m.state_column,p=m.value_column,b=m.state_code_type,n=m.width||950,j=m.height||n/1.9,t=m.title||d,g=m.color_range,f=m.color_gradient||["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],u=m.html_element||"body";var s=alamode.getDataFromQuery(d);var e=d3.map();var r=d3.geoAlbersUsa().scale(n).translate([n/2,j/2]);var k=d3.geoPath().projection(r);var a=alamode.addContainerElement(u);d3.select(a).append("div").attr("class","mode-graphic-title").text(t);svg=d3.select(a).append("div").attr("class","mode-state-chorolpleth").append("svg").attr("id","mode-state-chorolpleth-"+l).attr("width",n).attr("height",j);s.forEach(function(o){e.set(o[c],+o[p])});if(!g){colorDomain=d3.extent(s,function(o){return o[p]})}else{colorDomain=g}var q=d3.scale.quantize().domain(colorDomain).range(f);queue().defer(d3.json,"https://s3-us-west-2.amazonaws.com/mode-alamode/states.json").await(h);function h(o,v){d3.select("#mode-state-chorolpleth-"+l).append("g").attr("class","mode-state-chorolpleth-states").selectAll(".mode-state-chorolpleth-states-"+l).data(v.features).enter().append("path").attr("class","mode-state-chorolpleth-states-"+l).attr("fill",function(w){return q(e.get(w.properties[b]))}).attr("d",k)}},worldChoropleth:function(l){var k=alamode.makeId(10);var c=l.query_name,r=l.country_column,n=l.value_column,b=l.country_code_type,m=l.width||950,h=l.height||m*0.8,t=l.title||c,f=l.color_range,e=l.color_gradient||["#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],u=l.html_element||"body";var s=alamode.getDataFromQuery(c);var d=d3.map();var q=d3.geo.mercator().scale((m+1)/2/Math.PI).translate([m/2,(h/2)+(h*0.1)]).precision(0.1);var j=d3.geoPath().projection(q);var a=alamode.addContainerElement(u);d3.select(a).append("div").attr("class","mode-graphic-title").text(t);d3.select(a).append("div").attr("class","mode-world-chorolpleth-legend").attr("id","mode-world-chorolpleth-legend-"+k).text("Hover over a country to see details");svg=d3.select(a).append("div").attr("class","mode-world-chorolpleth").append("svg").attr("id","mode-world-chorolpleth-"+k).attr("width",m).attr("height",h);s.forEach(function(o){d.set(o[r],+o[n])});if(!f){colorDomain=d3.extent(s,function(o){return o[n]})}else{colorDomain=f}var p=d3.scale.quantize().domain(colorDomain).range(e);queue().defer(d3.json,"https://s3-us-west-2.amazonaws.com/mode-alamode/world.json").await(g);function g(o,v){d3.select("#mode-world-chorolpleth-"+k).append("g").attr("class","mode-world-chorolpleth-countries-base").selectAll(".mode-world-chorolpleth-countries").data(topojson.feature(v,v.objects.countries).features).enter().append("path").attr("class","mode-world-chorolpleth-countries").attr("fill",function(w){return p(d.get(w.properties[b]))}).attr("d",j).on("mouseover",function(x){var w=x.properties.name;if(d.get(x.properties[b])){value=d.get(x.properties[b])}else{value="--"}d3.select("#mode-world-chorolpleth-legend-"+k).text(w+": "+value)}).on("mouseout",function(w){d3.select("#mode-world-chorolpleth-legend-"+k).text("Hover over a country to see details")});d3.select("#mode-world-chorolpleth-"+k).append("path").datum(topojson.mesh(v,v.objects.countries,function(x,w){return x!==w})).attr("class","mode-world-chorolpleth-boundaries").attr("d",j)}},pivotTable:function(l){var k=alamode.makeId(10);var d=l.query_name,q=l.default_columns,j=l.default_rows,p=l.default_values,n=l.editable,m=l.aggregate_function||"Count",b=l.pivot_table_type||"Table",v=l.default_column_value||d,w=l.html_element||"body",g=l.default_exclusions||[],f=l.default_inclusions||[];var u=alamode.getDataFromQuery(d),c=alamode.getColumnsFromQuery(d),e=_.map(c,"name");var a=alamode.addContainerElement(w);d3.select(a).append("div").attr("class","mode-graphic-title").text(v);d3.select(a).append("div").attr("class","mode-pivot-table").attr("id",k);var s=[];s.push(e);u.forEach(function(x){var o=[];e.forEach(function(z){o.push(x[z])});s.push(o)});if(n){$("#"+k).pivotUI(s,{cols:q,rows:j,aggregatorName:m,vals:[p],rendererName:b,exclusions:g,inclusions:f})}else{var r=$.pivotUtilities;var t=r.renderers[b];var h=r.aggregators[m];$("#"+k).pivot(s,{cols:q,rows:j,aggregator:h([p]),renderer:t,exclusions:g,inclusions:f})}},pieChartLabels:function(e){var b=e.show_all_labels,f=e.chart_id,c=$("#"+f);var d={};setInterval(function(){a(c,b)},300);function a(h,g){h.find(".nv-legendWrap .nv-series text").each(function(k){var j=$(this).text();h.find(".nv-pieWrap .nv-pieLabels text").each(function(l){var m=k+"-"+l;text=$(this).text();if(k==l&&text!=""&&text!=d[m]){text=j+" - "+text}else{if(k==l&&g&&text!=d[m]){text=j}}d[m]=text;$(this).text(text)})})}},bigNumberSparkline:function(a){var q="#"+a.chart_id,l=a.x_axis_column,j=a.value_column,f=a.query_name,m=alamode.makeId(12);var b=alamode.getDataFromQuery(f),k=alamode.getColumnsFromQuery(f);if(l){xMatch=_.filter(k,{name:l}),xType=xMatch[0].type}else{xType="string"}var e=[];b.forEach(function(r){if(xType=="datetime"||xType=="timestamp"||xType=="date"){formattedX=d3.time.format.utc("%Y-%m-%d")(new Date(Date.parse(r[l])))}else{formattedX=r[l]}var o={x:formattedX,y:r[j]};e.push(o)});var d=$(q+" .chart-wrapper"),p=$(q+" .chart-big-number"),h=d.height(),c=d.width(),g=p.height(),n=(h-g-20);d3.select(q+" .chart-big-number").append("svg").attr("height",n).attr("width",c).attr("id",m).append("g").attr("transform","translate(0,"+g+")");nv.addGraph(function(){var o=nv.models.sparklinePlus().margin({left:15,right:15}).x(function(s,r){return r}).xTickFormat(function(r){return e[r].x}).showLastValue(false);d3.select("#"+m).datum(e).call(o);return o});setTimeout(function(){d3.selectAll(q+" path").style("stroke-width","2px").style("stroke-linejoin","round").style("stroke","#646C6C");d3.selectAll(q+" .nv-minValue").style("fill","#EE7437").style("stroke","#EE7437").attr("r",3);d3.selectAll(q+" .nv-maxValue").style("fill","#37B067").style("stroke","#37B067").attr("r",3);d3.selectAll(q+" .nv-currentValue").style("fill","#22A3C0").style("stroke","#22A3C0").attr("r",3)},1000)},addLinkToBigNumber:function(b){var c="#"+b.chart_id,a=b.url;$(c+" .chart-big-number .aggregate span").replaceWith(function(){var d=$.trim($(this).text());return"<a style='text-decoration: underline;' href='"+a+"' target='_blank'>"+d+"</a>"})},forceDirectedGraph:function(n){var m=alamode.makeId(10);var v=n.node_query,u=n.edge_query,A=n.html_element||"body",z=n.title||queryName,q=n.chart_width||"800",k=n.chart_height||"800",h=n.group_colors||"",e=n.links_to_show||100;var r=alamode.getDataFromQuery(v),t=alamode.getDataFromQuery(u);var d=[];t.forEach(function(o){var C=d.filter(function(D){return D.target==o.source}),B=C.filter(function(D){return D.source==o.target});if(B.length!=0){B.edge_size+=o.edge_size}else{d.push(o)}});d=d.sort(function(B,o){return o.edge_size-B.edge_size});d=d.slice(0,e);nameMap={};r.forEach(function(B,o){B.id=o;nameMap[B.node]=o});d.forEach(function(o){o.source_id=nameMap[o.source];o.target_id=nameMap[o.target]});var a=alamode.addContainerElement(A);d3.select(a).append("div").attr("class","mode-graphic-title").text(z);d3.select(a).append("div").attr("class","mode-force-directed-graph").style("width",q).attr("id",m);var j=d3.tip().attr("class","mode-force-directed-graph-tooltip").offset([-10,0]).html(function(o){return o.node});var b=d3.layout.force().linkDistance(40).linkStrength(1).size([q,k]);var l=d3.select("#"+m).append("svg").attr("width",q).attr("height",k);l.call(j);var c={nodes:r,links:d};var w=d3.scale.linear().domain(d3.extent(r,function(o){return o.node_size})).range([2,20]);var g=d3.scale.linear().domain(d3.extent(d,function(o){return o.edge_size})).range([1,10]);var x=d3.scale.linear().domain(d3.extent(d,function(o){return o.edge_size})).range([0.1,0.9]);var r=c.nodes.slice(),d=[],p=[];c.links.forEach(function(D){var C=r[D.source_id],B=r[D.target_id],o={};o.connections=D.edge_size;r.push(o);d.push({source:C,target:o},{source:o,target:B});p.push([C,o,B])});b.nodes(r).links(d).start();var f=l.selectAll(".mode-force-directed-graph-link ").data(p).enter().append("path").attr("class","mode-force-directed-graph-link").style("stroke-width",function(o){return g(o[1]["connections"])}).style("opacity",function(o){return x(o[1]["connections"])});var s=l.selectAll(".mode-force-directed-graph-node").data(c.nodes).enter().append("g").attr("class","mode-force-directed-graph-node").call(b.drag);s.append("circle").attr("r",function(o){return w(o.node_size)}).style("fill",function(o){if(h){return h[o.node_group]}else{return"#0E819A"}}).on("mouseover",j.show).on("mouseout",j.hide);b.on("tick",function(){f.attr("d",function(o){return"M"+o[0].x+","+o[0].y+"S"+o[1].x+","+o[1].y+" "+o[2].x+","+o[2].y});s.attr("transform",function(o){return"translate("+o.x+","+o.y+")"})})},networkMatrix:function(t){var s=alamode.makeId(10);var C=t.node_query,B=t.edge_query,J=t.html_element||"body",I=t.title||queryName,m=t.padding_for_names||"200",v=t.chart_width||"800",r=t.chart_height||"800",j=t.group_colors||"",A=t.left_label||"",e=t.top_label||"";var p={top:m,right:10,bottom:10,left:m};var w=alamode.getDataFromQuery(C),c=alamode.getDataFromQuery(B);nameMap={};w.forEach(function(n,g){n.id=g;nameMap[n.node]=g});c.forEach(function(g){g.source_id=nameMap[g.source];g.target_id=nameMap[g.target]});var k=d3.scale.ordinal().rangeBands([0,v]);var h=d3.scale.linear().domain(d3.extent(c,function(g){return g.edge_size})).clamp(true);var a=alamode.addContainerElement(J);d3.select(a).append("div").attr("class","mode-graphic-title").text(I);d3.select(a).append("div").attr("class","mode-network-matrix-order-picker").html('<p>Order: <select id="mode-network-matrix-order-picker-'+s+'"><option value="name">Name</option><option value="count">Frequency</option><option value="group">Group</option></select>');d3.select(a).append("div").attr("class","mode-network-matrix").style("width",v).attr("id",s);var l=d3.tip().attr("class","mode-network-matrix-tooltip").offset([-10,0]).html(function(g){return g.z});var q=d3.select("#"+s).append("svg").attr("width",v+p.left+p.right).attr("height",r+p.top+p.bottom);q.call(l);var F=q.append("g").attr("transform","translate("+p.left+","+p.top+")");graph={nodes:w,links:c};var E=[],w=graph.nodes,u=w.length;w.forEach(function(n,g){n.index=g;n.count=0;E[g]=d3.range(u).map(function(o){return{x:o,y:g,z:0}})});graph.links.forEach(function(g){if(typeof(E[g.source_id][g.target_id])!=="undefined"){E[g.source_id][g.target_id].z+=g.edge_size;w[g.source_id].count+=g.edge_size;w[g.target_id].count+=g.edge_size}else{E[g.source_id][g.target_id]={};E[g.source_id][g.target_id]["z"]=0}});var b={name:d3.range(u).sort(function(n,g){return d3.ascending(w[n].node,w[g].node)}),count:d3.range(u).sort(function(n,g){return w[g].count-w[n].count}),group:d3.range(u).sort(function(n,g){return d3.ascending(w[n].node_group,w[g].node_group)})};k.domain(b.name);q.append("text").attr("class","mode-network-matrix-axis-label").attr("x",(v+p.left+p.right)/2).attr("y",25).attr("text-anchor","middle").text(e);q.append("text").attr("class","mode-network-matrix-axis-label").attr("x",(r+p.top+p.bottom)/-2).attr("y",25).attr("transform","rotate(-90)").attr("text-anchor","middle").text(A);F.append("rect").attr("class","mode-network-matrix-background").attr("width",v).attr("height",r);var f=F.selectAll(".mode-network-matrix-row").data(E).enter().append("g").attr("class","mode-network-matrix-row").attr("transform",function(n,g){return"translate(0,"+k(g)+")"}).each(f);f.append("line").attr("class","mode-network-matrix-line").attr("x2",v);f.append("text").attr("class","mode-network-matrix-row-text").attr("x",-6).attr("y",k.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").text(function(n,g){return w[g].node});var d=F.selectAll(".mode-network-matrix-column").data(E).enter().append("g").attr("class","mode-network-matrix-column").attr("transform",function(n,g){return"translate("+k(g)+")rotate(-90)"});d.append("line").attr("class","mode-network-matrix-line").attr("x1",-v);d.append("text").attr("class","mode-network-matrix-column-text").attr("x",6).attr("y",k.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").text(function(n,g){return w[g].node});function f(n){var g=d3.select(this).selectAll(".mode-network-matrix-cell").data(n.filter(function(o){return o.z})).enter().append("rect").attr("class","mode-network-matrix-cell").attr("x",function(o){return k(o.x)}).attr("width",k.rangeBand()).attr("height",k.rangeBand()).style("fill-opacity",function(o){return h(o.z)}).style("fill",function(o){return w[o.x].node_group==w[o.y].node_group?j[w[o.x].node_group]:"#2B2B2B"}).on("mouseover",function(o){H(o);l.show(o)}).on("mouseout",function(o){G(o);l.hide(o)})}function H(g){d3.selectAll(".mode-network-matrix-row-text").classed("active",function(o,n){return n==g.y});d3.selectAll(".mode-network-matrix-column-text").classed("active",function(o,n){return n==g.x})}function G(){d3.selectAll("text").classed("active",false)}d3.select("#mode-network-matrix-order-picker-"+s).on("change",function(){D(this.value)});function D(n){k.domain(b[n]);var g=F.transition().duration(1000);g.selectAll(".mode-network-matrix-row").attr("transform",function(x,o){return"translate(0,"+k(o)+")"}).selectAll(".mode-network-matrix-cell").attr("x",function(o){return k(o.x)});g.selectAll(".mode-network-matrix-column").attr("transform",function(x,o){return"translate("+k(o)+")rotate(-90)"})}},hive:function(k){d3.hive={},d3.hive.link=function(){function A(H,J){var F,I=o(D,this,H,J),G=o(E,this,H,J);I.a>G.a&&(F=G,G=I,I=F),G.a-I.a>Math.PI&&(I.a+=2*Math.PI);var K=I.a+(G.a-I.a)/3,M=G.a-(G.a-I.a)/3;return I.r0-I.r1||G.r0-G.r1?"M"+Math.cos(I.a)*I.r0+","+Math.sin(I.a)*I.r0+"L"+Math.cos(I.a)*I.r1+","+Math.sin(I.a)*I.r1+"C"+Math.cos(K)*I.r1+","+Math.sin(K)*I.r1+" "+Math.cos(M)*G.r1+","+Math.sin(M)*G.r1+" "+Math.cos(G.a)*G.r1+","+Math.sin(G.a)*G.r1+"L"+Math.cos(G.a)*G.r0+","+Math.sin(G.a)*G.r0+"C"+Math.cos(M)*G.r0+","+Math.sin(M)*G.r0+" "+Math.cos(K)*I.r0+","+Math.sin(K)*I.r0+" "+Math.cos(I.a)*I.r0+","+Math.sin(I.a)*I.r0:"M"+Math.cos(I.a)*I.r0+","+Math.sin(I.a)*I.r0+"C"+Math.cos(K)*I.r1+","+Math.sin(K)*I.r1+" "+Math.cos(M)*G.r1+","+Math.sin(M)*G.r1+" "+Math.cos(G.a)*G.r1+","+Math.sin(G.a)*G.r1}function o(G,F,H,O){var I=G.call(F,H,O),N=+("function"==typeof C?C.call(F,I,O):C)+z,J=+("function"==typeof x?x.call(F,I,O):x),K=x===B?J:+("function"==typeof B?B.call(F,I,O):B);return{r0:J,r1:K,a:N}}var D=function(F){return F.source},E=function(F){return F.target},C=function(F){return F.angle},x=function(F){return F.radius},B=x,z=-Math.PI/2;return A.source=function(F){return arguments.length?(D=F,A):D},A.target=function(F){return arguments.length?(E=F,A):E},A.angle=function(F){return arguments.length?(C=F,A):C},A.radius=function(F){return arguments.length?(x=B=F,A):x},A.startRadius=function(F){return arguments.length?(x=F,A):x},A.endRadius=function(F){return arguments.length?(B=F,A):B},A};var j=alamode.makeId(10);var q=k.node_query,p=k.edge_query,t=k.groups_are_numeric,w=k.html_element||"body",v=k.title||queryName,l=k.chart_width||"800",h=k.chart_height||"800",e=k.group_colors||"";var n=Math.min(l,h)/2-30,d=n*0.2;var m=alamode.getDataFromQuery(q),b=alamode.getDataFromQuery(p);var u=_.uniq(_.map(m,"node_group"));var s={};m.forEach(function(o){if(t){o.x=o.node_group}else{o.x=u.indexOf(o.node_group)}o.y=o.node_size;s[o.node]=o});b.forEach(function(o){o.source=s[o.source],o.target=s[o.target]});var a=alamode.addContainerElement(w);d3.select(a).append("div").attr("class","mode-graphic-title").text(v);d3.select(a).append("div").attr("class","mode-network-matrix").style("width",l).attr("id",j);if(t){angle=d3.scale.linear().domain(d3.extent(m,function(o){return o.node_group})).range([0,2*Math.PI])}else{angle=d3.scale.ordinal().domain(d3.range(u.length+1)).rangePoints([0,2*Math.PI])}var c=d3.scale.linear().domain(d3.extent(m,function(o){return o.node_size})).range([d,n]);var f=d3.tip().attr("class","mode-hive-tooltip").offset([-10,0]).html(function(o){return o.node});var g=d3.select("#"+j).append("svg").attr("width",l).attr("height",h).append("g").attr("transform","translate("+l/2+","+h/2+")");g.call(f);g.selectAll(".mode-hive-axis").data(d3.range(u.length)).enter().append("line").attr("class","mode-hive-axis").attr("transform",function(o){return"rotate("+r(angle(o))+")"}).attr("x1",c.range()[0]).attr("x2",c.range()[1]);g.selectAll(".mode-hive-link").data(b).enter().append("path").attr("class","mode-hive-link").attr("d",d3.hive.link().angle(function(o){return angle(o.x)}).radius(function(o){return c(o.y)})).style("stroke",function(o){return e[o.source.node_group]});g.selectAll(".mode-hive-node").data(m).enter().append("circle").attr("class","mode-hive-node").attr("transform",function(o){return"rotate("+r(angle(o.x))+")"}).attr("cx",function(o){return c(o.y)}).attr("r",5).style("fill",function(o){return e[o.node_group]}).on("mouseover",function(o){f.show(o);d3.select(this).attr("class","mode-hive-node mode-hive-node-selected");d3.selectAll(".mode-hive-link").data(b).attr("class",function(x){if(x.source.node==o.node){return"mode-hive-link-selected"}else{if(x.target.node==o.node){return"mode-hive-link-selected"}else{return"mode-hive-link"}}})}).on("mouseout",function(o){f.hide(o);d3.select(this).attr("class","mode-hive-node");d3.selectAll(".mode-hive-link-selected").attr("class","mode-hive-link")});function r(o){return o/Math.PI*180-90}},conditionalFormattingByColumn:function(a){var b="#"+a.table_id,j=a.query_name,m=a.column_rules;var h=alamode.getDataFromQuery(j),d=alamode.getColumnsFromQuery(j);var l={};setTimeout(function(){k(m)},1000);$(b).mousemove(function(){k(m)});function k(n){var p=$(b+" table"),o=$(b+" .js-header-table"),s=!o?$(o).find("th"):$(b+" .js-col-header"),r=p.find("tr"),q=0;s.each(function(){text=$(this).find(".axel-table-header-label").text();q=$(this).attr("data-axel-column");l[text]=q});n.forEach(function(t){t.rules.forEach(function(v){var u=v.shade_text||false;if(v.type=="gradient"){f(t.column,v.color,u)}else{if(v.type=="above"||v.type=="below"||v.type=="equal"){c(t.column,v.type,v.value,v.color,u)}}})})}function f(q,p,r){var o=d3.extent(_.map(h,q));var s=d3.scale.linear().domain(o).interpolate(d3.interpolateHsl).range(p);var n=l[q];h.forEach(function(x,v){var u=b+" table [data-axel-rowkey='"+v+"'][data-axel-column='"+n+"']",z=s(x[q]),w=g(z),t=$(u);if(r){t.css("color",z)}else{t.css({background:z,color:w})}})}function c(r,q,o,p,t){var n=l[r];var s=g(p);h.forEach(function(x,w){var v=b+" table [data-axel-rowkey='"+w+"'][data-axel-column='"+n+"']",u=$(v);if(q=="above"&&x[r]>=o){if(t){u.css("color",p)}else{u.css({background:p,color:s})}}else{if(q=="below"&&x[r]<=o){if(t){u.css("color",p)}else{u.css({background:p,color:s})}}else{if(q=="equal"&&x[r]==o){if(t){u.css("color",p)}else{u.css({background:p,color:s})}}}}})}function e(o){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function g(o){var n=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(o);if(n){rgb=e(o);a=Math.round(((parseInt(rgb.r)*299)+(parseInt(rgb.g)*587)+(parseInt(rgb.b)*114))/1000)}else{a=255}if(a>125){return"#2B2B2B"}else{return"#FCFCFC"}}},conditionalFormattingByTable:function(c){var d="#"+c.table_id,m=c.query_name,l=c.columns;rules=c.rules;var k=alamode.getDataFromQuery(m),f=alamode.getColumnsFromQuery(m);var p={};var a=[];l.forEach(function(q){var o=d3.extent(_.map(k,q));a=a.concat(o)});var b=d3.extent(a);setTimeout(function(){n(rules)},1000);$(d).mousemove(function(){n(rules)});function n(u){var q=$(d+" table"),o=$(d+" .js-header-table"),t=!o?$(o).find("th"):$(d+" .js-col-header"),s=q.find("tr"),r=0;t.each(function(){text=$(this).find(".axel-table-header-label").text();r=$(this).attr("data-axel-column");p[text]=r});u.forEach(function(w){var v=w.shade_text||false;if(w.type=="gradient"){h(w.color,v)}else{if(w.type=="above"||w.type=="below"||w.type=="equal"){e(w.type,w.value,w.color,v)}}})}function h(o,q){var r=d3.scale.linear().domain(b).interpolate(d3.interpolateHsl).range(o);k.forEach(function(t,s){l.forEach(function(A){var w=p[A];var v=d+" table [data-axel-rowkey='"+s+"'][data-axel-column='"+w+"']",z=r(t[A]),x=j(z),u=$(v);if(q){u.css("color",z)}else{u.css({background:z,color:x})}})})}function e(r,o,q,t){var s=j(q);k.forEach(function(v,u){l.forEach(function(A){var z=p[A];var x=d+" table [data-axel-rowkey='"+u+"'][data-axel-column='"+z+"']",w=$(x);if(r=="above"&&v[A]>=o){if(t){w.css("color",q)}else{w.css({background:q,color:s})}}else{if(r=="below"&&v[A]<=o){if(t){w.css("color",q)}else{w.css({background:q,color:s})}}else{if(r=="equal"&&v[A]==o){if(t){w.css("color",q)}else{w.css({background:q,color:s})}}}}})})}function g(q){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(q);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function j(q){var o=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(q);if(o){rgb=g(q);c=Math.round(((parseInt(rgb.r)*299)+(parseInt(rgb.g)*587)+(parseInt(rgb.b)*114))/1000)}else{c=255}if(c>125){return"#2B2B2B"}else{return"#FCFCFC"}}},addTableOfContents:function(h){if(typeof(h)==="undefined"){h="default"}var d=h.text_color,b=h.background_color,c=h.hover_color;$(".mode-header").addClass("has-nav");var g=$("<nav class='fixed-nav-bar'></nav>");$(".row").each(function(){var j=$(this).children();j.each(function(){var m;var n=$(this).find("mode-chart").attr("id")||$(this).find("mode-table").attr("id")||$(this).find("mode-python").attr("id");if(!n){return true}if(n.includes("chart")||n.includes("table")){var k=document.getElementById(n);if($(k).find("mode-pivot-table").length>0){m=document.getElementById(n).getElementsByClassName("in-place-edit-text")[0].innerText}else{m=document.getElementById(n).getElementsByClassName("chart-title")[0].innerText}}else{if(n.includes("python")){m=document.getElementById(n).getElementsByClassName("in-place-edit-text")[0].innerText}}var l=$("<a class='scroll-link' href=#"+n+">"+(m.includes("Click to add title")?"Untitled":m)+"</a>");g.append(l)})});var f=$("<div class='mode-grid container''></div>");$(".mode-content").prepend(f);var e=$("<div class='row'></div>");f.prepend(e);var a=$("<div class='col-md-12'></div>");e.prepend(a);a.prepend(g);if(!!d){$(".fixed-nav-bar a").css("color",d)}if(!!b){$(".fixed-nav-bar").css("background-color",b)}if(!!c){$(".fixed-nav-bar a").hover(function(){$(this).css("color",c)},function(){if(!!d){$(this).css("color",d)}else{$(this).css("color","")}})}setTimeout(function(){$(".scroll-link").on("click",function(l){l.preventDefault();var k=$(this).attr("href");j(k,750)});function j(n,l){var k=50;var m=$(n).offset().top-k;$("html,body").animate({scrollTop:m},l)}},100)}};